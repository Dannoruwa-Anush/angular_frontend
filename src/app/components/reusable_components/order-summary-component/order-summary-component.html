<mat-card class="invoice-card">

  <!-- HEADER -->
  <div class="header">
    <div>
      <h2>Order Invoice</h2>
      <p><strong>Order ID:</strong> {{ order.orderID }}</p>
      <p><strong>Order Date:</strong> {{ order.orderDate | date:'mediumDate' }}</p>
    </div>

    <div class="status">
      <mat-chip color="primary" selected>
        Order Status: {{ getOrderStatusLabel(order.orderStatus) }}
      </mat-chip>

      <mat-chip [color]="order.orderPaymentStatus === 1 ? 'accent' : 'warn'" selected>
        Payment Status: {{ OrderPaymentStatusEnum[order.orderPaymentStatus] }}
      </mat-chip>
    </div>
  </div>

  <mat-divider></mat-divider>

  <!-- ORDER STATUS STEPPER -->
  <mat-stepper class="order-stepper" [selectedIndex]="getStepIndex()" linear="false">

    <!-- Pending -->
    <mat-step>
      <ng-template matStepLabel>
        <mat-icon>hourglass_empty</mat-icon>
        Pending
      </ng-template>
      <div class="step-date">{{ formatDate(order.orderDate) }}</div>
    </mat-step>

    <!-- Processing -->
    <mat-step>
      <ng-template matStepLabel>
        <mat-icon>settings</mat-icon>
        Processing Order
      </ng-template>
      <div class="step-date">Order is being prepared</div>
    </mat-step>

    <!-- Shipped -->
    <mat-step>
      <ng-template matStepLabel>
        <mat-icon>local_shipping</mat-icon>
        Shipped
      </ng-template>
      <div class="step-date">{{ formatDate(order.shippedDate) }}</div>
    </mat-step>

    <!-- Delivered -->
    <mat-step>
      <ng-template matStepLabel>
        <mat-icon>check_circle</mat-icon>
        Delivered
      </ng-template>
      <div class="step-date">{{ formatDate(order.deliveredDate) }}</div>

      <p *ngIf="order.orderStatus === OrderStatusEnum.DeliveredAfterCancellationRejected" class="info">
        Delivered after cancellation was rejected
      </p>
    </mat-step>

    <!-- Cancel Pending -->
    <mat-step>
      <ng-template matStepLabel>
        <mat-icon color="warn">pause_circle</mat-icon>
        Cancel Pending
      </ng-template>
      <div class="step-date">Cancellation requested</div>
    </mat-step>

    <!-- Cancelled -->
    <mat-step>
      <ng-template matStepLabel>
        <mat-icon color="warn">cancel</mat-icon>
        Cancelled
      </ng-template>
      <div class="step-date cancelled">{{ formatDate(order.cancelledDate) }}</div>
    </mat-step>
  </mat-stepper>

  <mat-divider></mat-divider>

  <!-- Customer Details -->
  <section class="customer">
    <h3>Customer Details</h3>
    <div class="customer-grid">
      <span><strong>Name:</strong> {{ order.customerResponseDto?.customerName }}</span>
      <span><strong>Phone:</strong> {{ order.customerResponseDto?.phoneNo }}</span>
      <span><strong>Email:</strong> {{ order.customerResponseDto?.userResponseDto?.email }}</span>
      <span><strong>Address:</strong> {{ order.customerResponseDto?.address }}</span>
    </div>
  </section>

  <mat-divider></mat-divider>

  <!-- Items Table -->
  <table mat-table [dataSource]="order.customerOrderElectronicItemResponseDto" class="mat-elevation-z1">

    <!-- Index -->
    <ng-container matColumnDef="index">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
    </ng-container>

    <!-- Product -->
    <ng-container matColumnDef="product">
      <th mat-header-cell *matHeaderCellDef>Product</th>
      <td mat-cell *matCellDef="let row" class="product-cell">
        <img class="product-image" [src]="fileService.getElectronicItemImage(row.electronicItemResponseDto)" alt="product" />
        <span class="product-name">{{ row.electronicItemResponseDto.electronicItemName }}</span>
      </td>
    </ng-container>

    <!-- Unit Price -->
    <ng-container matColumnDef="unitPrice">
      <th mat-header-cell *matHeaderCellDef>Unit Price (Rs.)</th>
      <td mat-cell *matCellDef="let row">{{ row.unitPrice }}</td>
    </ng-container>

    <!-- Quantity -->
    <ng-container matColumnDef="quantity">
      <th mat-header-cell *matHeaderCellDef>Qty</th>
      <td mat-cell *matCellDef="let row">{{ row.quantity }}</td>
    </ng-container>

    <!-- Sub Total -->
    <ng-container matColumnDef="subTotal">
      <th mat-header-cell *matHeaderCellDef>Sub Total (Rs.)</th>
      <td mat-cell *matCellDef="let row">{{ row.subTotal }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

  </table>

  <mat-divider></mat-divider>

  <!-- Total -->
  <div class="total">
    <h2>Total: Rs. {{ order.totalAmount }}</h2>
  </div>
</mat-card>