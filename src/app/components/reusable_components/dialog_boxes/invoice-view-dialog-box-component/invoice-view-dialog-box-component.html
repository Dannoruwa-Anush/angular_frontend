<h2 mat-dialog-title>
  Invoice #{{ data.invoice.invoiceID }}
</h2>

<mat-dialog-content class="dialog-content">

  <!-- ================= INVOICE (ALWAYS VISIBLE) ================= -->

  <div *ngIf="loading()" class="spinner-overlay">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>

  <iframe
    class="invoice-frame"
    [src]="data.invoice.invoiceFileUrl | safeUrl"
    (load)="onLoad()">
  </iframe>

  <!-- ================= PAYMENT SECTION (VISIBLE AFTER PAY) ================= -->

  <ng-container *ngIf="mode() === 'PAY'">

    <div class="payment-container">

      <!-- CASH -->
      <mat-card
        class="payment-option"
        [class.active]="paymentMethod() === 'CASH'"
        (click)="paymentMethod.set('CASH')">

        <mat-radio-button [checked]="paymentMethod() === 'CASH'">
          <div class="option-content">
            <mat-icon>payments</mat-icon>
            <div>
              <h3>Cash Payment</h3>
              <p>Pay on delivery</p>
            </div>
          </div>
        </mat-radio-button>
      </mat-card>

      <!-- CARD -->
      <mat-card
        class="payment-option"
        [class.active]="paymentMethod() === 'CARD'"
        (click)="paymentMethod.set('CARD')">

        <mat-radio-button [checked]="paymentMethod() === 'CARD'">
          <div class="option-content">
            <mat-icon>credit_card</mat-icon>
            <div>
              <h3>Card Payment</h3>
              <p>Visa, MasterCard</p>
            </div>
          </div>
        </mat-radio-button>
      </mat-card>

      <!-- CARD FORM -->
      <form
        *ngIf="paymentMethod() === 'CARD'"
        [formGroup]="form"
        class="card-form">

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Card Number</mat-label>
          <input matInput formControlName="cardNumber">
          <mat-error *ngIf="cardNumberCtrl.hasError('required')">
            Card number is required
          </mat-error>
          <mat-error *ngIf="cardNumberCtrl.hasError('pattern')">
            Must be exactly 16 digits
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Cardholder Name</mat-label>
          <input matInput formControlName="cardHolderName">
          <mat-error *ngIf="cardHolderNameCtrl.hasError('required')">
            Card holder name is required
          </mat-error>
          <mat-error *ngIf="cardHolderNameCtrl.hasError('pattern')">
            Only letters and spaces allowed
          </mat-error>
        </mat-form-field>

        <div class="row">
          <mat-form-field appearance="outline">
            <mat-label>Expiry</mat-label>
            <input matInput placeholder="MM/YY" formControlName="cardExpiry">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>CVV</mat-label>
            <input matInput type="password" formControlName="cardCvv">
          </mat-form-field>
        </div>

      </form>

    </div>

  </ng-container>

</mat-dialog-content>

<mat-dialog-actions align="end">

  <button
    mat-button
    color="primary"
    *ngIf="mode() !== 'PAY'"
    (click)="onPay()">
    Pay
  </button>

  <button
    mat-raised-button
    color="primary"
    *ngIf="mode() === 'PAY'"
    [disabled]="paymentMethod() === 'CARD' && form.invalid"
    (click)="confirmPayment()">
    Confirm Payment
  </button>

  <button mat-button color="warn" (click)="onCancelInvoice()">Cancel</button>
  <button mat-button (click)="onClose()">Close</button>

</mat-dialog-actions>