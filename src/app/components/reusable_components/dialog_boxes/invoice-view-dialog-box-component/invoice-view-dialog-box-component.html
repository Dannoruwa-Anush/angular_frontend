<h2 mat-dialog-title>
  Invoice #{{ invoice()?.invoiceID }}
</h2>

<mat-dialog-content class="dialog-content">

  <!-- ================= LOADING ================= -->
  <div *ngIf="loading()" class="spinner-overlay">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>

  <!-- ================= PDF VIEWER ================= -->
  <iframe *ngIf="pdfUrl() as url" class="invoice-frame" [class.receipt]="showReceipt()" [src]="url | safeUrl"
    (load)="onLoad()">
  </iframe>

  <!-- ================= PAYMENT ================= -->
  <ng-container *ngIf="mode() === 'PAY' && showInvoice()">

    <div class="payment-container">

      <!-- CASH (CASHIER ONLY) -->
      <mat-card *ngIf="isCashier()" class="payment-option" [class.active]="paymentMethod() === 'CASH'"
        (click)="paymentMethod.set('CASH')">

        <mat-radio-button [checked]="paymentMethod() === 'CASH'">
          <div class="option-content">
            <mat-icon>payments</mat-icon>
            <div>
              <h3>Cash Payment</h3>
              <p>Pay on delivery</p>
            </div>
          </div>
        </mat-radio-button>
      </mat-card>

      <!-- CARD -->
      <mat-card class="payment-option" [class.active]="paymentMethod() === 'CARD'" (click)="paymentMethod.set('CARD')">

        <mat-radio-button [checked]="paymentMethod() === 'CARD'">
          <div class="option-content">
            <mat-icon>credit_card</mat-icon>
            <div>
              <h3>Card Payment</h3>
              <p>Visa, MasterCard</p>
            </div>
          </div>
        </mat-radio-button>
      </mat-card>

      <!-- CARD FORM -->
      <form *ngIf="paymentMethod() === 'CARD'" [formGroup]="form" class="card-form">

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Card Number</mat-label>
          <input matInput formControlName="cardNumber">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Cardholder Name</mat-label>
          <input matInput formControlName="cardHolderName">
        </mat-form-field>

        <div class="row">
          <mat-form-field appearance="outline">
            <mat-label>Expiry</mat-label>
            <input matInput placeholder="MM/YY" formControlName="cardExpiry">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>CVV</mat-label>
            <input matInput type="password" formControlName="cardCvv">
          </mat-form-field>
        </div>

      </form>

    </div>
  </ng-container>

</mat-dialog-content>

<!-- ================= ACTIONS ================= -->
<mat-dialog-actions align="end">

  <!-- PAY -->
  <button mat-button color="primary" *ngIf="mode() !== 'PAY' && canShowPay() && showInvoice()" [disabled]="saving()"
    (click)="onPay()">
    Pay
  </button>

  <!-- CONFIRM -->
  <button mat-raised-button color="primary" *ngIf="mode() === 'PAY'"
    [disabled]="saving() || (paymentMethod() === 'CARD' && form.invalid)" (click)="confirmPayment()">
    Confirm Payment
  </button>

  <!-- CANCEL -->
  <button mat-button color="warn" *ngIf="canShowCancel()" [disabled]="saving()" (click)="onCancelInvoice()">
    Cancel
  </button>

  <!-- CLOSE -->
  <button mat-button [disabled]="saving()" (click)="onClose()">
    Close
  </button>

</mat-dialog-actions>