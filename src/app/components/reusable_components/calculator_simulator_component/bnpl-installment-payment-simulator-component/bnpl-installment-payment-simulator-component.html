<!-- ORDER & PLAN SUMMARY -->
<mat-card class="section-card">
  <mat-card-title>BNPL Payment</mat-card-title>

  <div class="summary-grid">
    <div>
      <label>Order ID</label>
      <strong>#{{ orderId }}</strong>
    </div>

    <div>
      <label>Total Order Amount</label>
      <strong>Rs. {{ totalAmount | number:'1.2-2' }}</strong>
    </div>

    <div>
      <label>Plan Type</label>
      <strong>{{ planType }}</strong>
    </div>

    <div>
      <label>Interest Rate</label>
      <strong>{{ interestRate }}%</strong>
    </div>
  </div>
</mat-card>

<!-- INSTALLMENT BREAKDOWN -->
<mat-card class="section-card">
  <mat-card-title>Installment Breakdown</mat-card-title>

  <table mat-table [dataSource]="installments" class="mat-elevation-z1">

    <ng-container matColumnDef="no">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <td mat-cell *matCellDef="let i">{{ i.installmentNo }}</td>
    </ng-container>

    <ng-container matColumnDef="dueDate">
      <th mat-header-cell *matHeaderCellDef>Due Date</th>
      <td mat-cell *matCellDef="let i">
        {{ i.installment_DueDate | date }}
      </td>
    </ng-container>

    <ng-container matColumnDef="base">
      <th mat-header-cell *matHeaderCellDef>Base</th>
      <td mat-cell *matCellDef="let i">
        Rs. {{ i.installment_BaseAmount | number:'1.2-2' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="total">
      <th mat-header-cell *matHeaderCellDef>Total Due</th>
      <td mat-cell *matCellDef="let i">
        Rs. {{ i.totalDueAmount | number:'1.2-2' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let i">
        <mat-chip color="primary" selected>
          Pending
        </mat-chip>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="installmentColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: installmentColumns"></tr>

  </table>
</mat-card>

<!-- SETTLEMENT SUMMARY -->
<mat-card class="section-card highlight">
  <mat-card-title>Settlement Summary</mat-card-title>

  <div class="settlement-row">
    <span>Current Installment No</span>
    <strong>{{ settlement.currentInstallmentNo }}</strong>
  </div>

  <div class="settlement-row">
    <span>Base Amount Due</span>
    <strong>Rs. {{ settlement.notYetDueCurrentInstallmentBaseAmount | number:'1.2-2' }}</strong>
  </div>

  <div class="settlement-row">
    <span>Late Interest</span>
    <strong>Rs. {{ settlement.total_LateInterest | number:'1.2-2' }}</strong>
  </div>

  <mat-divider></mat-divider>

  <div class="settlement-total">
    Payable Now:
    Rs. {{ settlement.total_PayableSettlement | number:'1.2-2' }}
  </div>
</mat-card>

<!-- PAYMENT SIMULATOR -->
<mat-card class="section-card">
  <mat-card-title>Payment Simulator</mat-card-title>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Payment Amount (Rs.)</mat-label>
    <input matInput type="number"
           [(ngModel)]="paymentAmount">
  </mat-form-field>

  <button mat-stroked-button color="primary"
          (click)="simulatePayment()">
    Run Simulation
  </button>
</mat-card>

<!-- SIMULATION RESULT -->
<mat-card *ngIf="simulationResult" class="section-card preview">
  <mat-card-title>Simulation Result</mat-card-title>

  <div class="result-row">
    <span>Applied to Base</span>
    <strong>Rs. {{ simulationResult.paidToBase }}</strong>
  </div>

  <div class="result-row">
    <span>Applied to Interest</span>
    <strong>Rs. {{ simulationResult.paidToInterest }}</strong>
  </div>

  <div class="result-row">
    <span>Remaining Balance</span>
    <strong>Rs. {{ simulationResult.remainingBalance }}</strong>
  </div>

  <div class="result-status">
    Status: <strong>{{ simulationResult.resultStatus }}</strong>
  </div>
</mat-card>

<!-- CONFIRM & PAY -->
 <button mat-raised-button
        color="accent"
        class="confirm-btn"
        [disabled]="!simulationResult"
        (click)="confirmPayment()">
  Confirm & Pay
</button>

<!-- PAYMENT RESULT BREAKDOWN -->
 <mat-card *ngIf="paymentResult" class="section-card success">
  <mat-card-title>Payment Successful</mat-card-title>

  <div class="result-row">
    <span>Applied to Base</span>
    <strong>Rs. {{ paymentResult.appliedToBase }}</strong>
  </div>

  <div class="result-row">
    <span>Overpayment</span>
    <strong>Rs. {{ paymentResult.overPayment }}</strong>
  </div>

  <mat-divider></mat-divider>

  <div class="result-status">
    New Status: <strong>{{ paymentResult.newStatus }}</strong>
  </div>
</mat-card>
