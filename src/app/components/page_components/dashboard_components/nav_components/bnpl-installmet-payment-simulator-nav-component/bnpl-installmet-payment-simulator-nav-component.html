<div class="dashboard-container">

  <!-- SIMULATOR FORM -->
  <mat-card class="section-card simulator-card">

    <div class="card-header">
      <div class="header-left">
        <mat-icon color="primary">calculate</mat-icon>
        <div>
          <div class="card-title">Payment Simulation</div>
          <div class="card-subtitle">
            Simulate how a payment will be distributed
          </div>
        </div>
      </div>
    </div>

    <form [formGroup]="form" class="simulator-form">

      <!-- ORDER LOAD -->
      <div class="form-row boxed-row">
        <mat-form-field appearance="outline" class="order-field">
          <mat-label>Order Number</mat-label>
          <input matInput type="number" formControlName="orderId" />
        </mat-form-field>

        <button
          mat-flat-button
          color="primary"
          type="button"
          (click)="loadSnapshot()">
          Load Snapshot
        </button>
      </div>

      <!-- PAYMENT -->
      <div class="payment-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Payment Amount</mat-label>
          <input matInput type="number" formControlName="paymentAmount" />
          <mat-hint>Enter the amount customer intends to pay</mat-hint>
        </mat-form-field>
      </div>

      <!-- ACTIONS -->
      <div class="form-actions">
        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="simulate()">
          Simulate Payment
        </button>

        <button
          mat-stroked-button
          color="warn"
          type="button"
          (click)="reset()">
          Reset
        </button>
      </div>

    </form>
  </mat-card>

  <!-- SNAPSHOT RESULT -->
  <mat-card *ngIf="snapshot() as s" class="section-card snapshot-card">

    <div class="card-header">
      <div>
        <div class="card-title">Installment Snapshot</div>
        <div class="card-subtitle">
          Current Installment #{{ s.currentInstallmentNo }}
        </div>
      </div>
    </div>

    <div class="snapshot-header">
      <div class="snapshot-metric">
        <span class="label">Total Payable</span>
        <span class="value">
          {{ s.total_PayableSettlement | number:'1.2-2' }}
        </span>
      </div>

      <div class="total-payable-box">
        <span class="label">Remaining After Simulation</span>
        <span class="value">
          {{ simulation()?.totalRemaining ?? s.total_PayableSettlement | number:'1.2-2' }}
        </span>
      </div>
    </div>

    <!-- TABLE -->
    <table mat-table
           [dataSource]="snapshotTableData()"
           class="snapshot-table">

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let r">{{ r.description }}</td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef class="text-right">Amount</th>
        <td mat-cell *matCellDef="let r" class="text-right">
          {{ r.amount | number:'1.2-2' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="paid">
        <th mat-header-cell *matHeaderCellDef class="text-right">Paid</th>
        <td mat-cell *matCellDef="let r" class="text-right">
          {{ r.paid | number:'1.2-2' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="result">
        <th mat-header-cell *matHeaderCellDef class="text-right">
          Remaining
        </th>
        <td mat-cell *matCellDef="let r"
            class="text-right result">
          {{ r.result | number:'1.2-2' }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="snapshotColumns"></tr>
      <tr mat-row
          *matRowDef="let row; columns: snapshotColumns"
          [ngClass]="getRowClass(row)">
      </tr>
    </table>

    <button
      mat-raised-button
      color="primary"
      class="invoice-btn"
      [disabled]="!simulation()"
      (click)="generateInvoice()">
      Generate Invoice
    </button>

  </mat-card>
</div>
